"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _helpers = require("../helpers");
var _AuditLogsState = require("../../audits/AuditLogsState");
var _helpers2 = require("../../helpers");
var _dummy = require("./dummy");
var _default = (store, api, actions) => {
  const originalActions = (0, _AuditLogsState.buildAuditLogsActions)(store, api, actions);
  const mockedActions = (0, _helpers.mockActionsExpect)(originalActions, ['setAuditLogsState', 'resetAuditLogsState']);
  mockedActions.loadAuditLogs = async payload => {
    mockedActions.setAuditLogsState({
      loading: !payload.silentLoading,
      error: null
    });
    const state = store.auditLogs.auditLogsState;
    const {
      columns
    } = store.auditLogs.auditsMetadataState;
    try {
      var _payload$pageSize, _payload$pageOffset, _payload$filter, _payload$sort, _payload$callback;
      const pageSize = (_payload$pageSize = payload.pageSize) != null ? _payload$pageSize : state.pageSize;
      const pageOffset = (_payload$pageOffset = payload.pageOffset) != null ? _payload$pageOffset : state.pageOffset;
      const filter = (_payload$filter = payload.filter) != null ? _payload$filter : state.filter;
      const sort = (_payload$sort = payload.sort) != null ? _payload$sort : state.sort;
      mockedActions.setAuditLogsState({
        pageSize,
        pageOffset,
        filter,
        sort
      });
      if (!columns) {
        await actions.loadAuditsMetadata();
      }
      const {
        data,
        total
      } = (0, _dummy.auditsLogsFilterAndSort)(filter, sort);
      mockedActions.setAuditLogsState({
        loading: false,
        logs: data != null ? data : [],
        totalPages: +Math.ceil(total / pageSize)
      });
      payload == null ? void 0 : (_payload$callback = payload.callback) == null ? void 0 : _payload$callback.call(payload, true);
    } catch (e) {
      var _payload$callback2;
      mockedActions.setAuditLogsState({
        loading: false,
        error: (0, _helpers2.errorHandler)(e)
      });
      payload == null ? void 0 : (_payload$callback2 = payload.callback) == null ? void 0 : _payload$callback2.call(payload, null, e);
    }
  };
  return mockedActions;
};
exports.default = _default;